<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CACPT Connect - Interactive Hub</title>
    <style>
        :root {
            /* Color Palette */
            --primary: #2563EB;
            --primary-hover: #1D4ED8;
            --bg-body: #F3F4F6;
            --bg-sidebar: #1F2937;
            --text-sidebar: #D1D5DB;
            --text-sidebar-active: #FFFFFF;
            --white: #FFFFFF;
            --text-main: #1F2937;
            --text-muted: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styles */
        aside {
            width: 260px;
            background-color: var(--bg-sidebar);
            color: var(--text-sidebar);
            display: flex;
            flex-direction: column;
            padding: 20px;
            flex-shrink: 0;
            transition: width 0.3s ease;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand span {
            color: var(--primary);
        }

        nav button {
            background: none;
            border: none;
            width: 100%;
            padding: 12px 16px;
            text-align: left;
            color: var(--text-sidebar);
            font-size: 1rem;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        nav button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        nav button.active {
            background-color: var(--primary);
            color: var(--white);
        }

        nav button svg {
            width: 20px;
            height: 20px;
        }

        /* Language Toggle */
        .lang-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .lang-toggle:hover { background: rgba(255, 255, 255, 0.2); }

        /* Main Content Area */
        main {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            position: relative;
        }

        header {
            margin-bottom: 32px;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        p.subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        /* Cards & Containers */
        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .badge-live {
            background-color: #EF4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .badge-live::before {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        /* Video Player */
        .video-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            position: relative;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Announcement Section */
        .announcement-box {
            border-left: 5px solid var(--primary);
            background-color: #EFF6FF;
        }

        .announcement-text {
            font-size: 1.1rem;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* ZOOM SPECIFIC STYLES */
        .zoom-hero {
            text-align: center;
            padding: 40px 20px;
        }

        .zoom-icon-circle {
            width: 100px;
            height: 100px;
            background-color: #E0F2FE;
            color: #0284C7;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
        }

        .zoom-details-grid {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .zoom-detail-item {
            background: #F9FAFB;
            padding: 15px 25px;
            border-radius: 8px;
            border: 1px solid var(--border);
            min-width: 200px;
        }

        .zoom-detail-label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .zoom-detail-value {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text-main);
        }

        /* Calendar Styles */
        .calendar-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }

        .cal-day-header {
            font-weight: 600;
            color: var(--text-muted);
            padding: 10px 0;
        }

        .cal-day {
            padding: 15px;
            border-radius: 8px;
            background-color: #F9FAFB;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid transparent;
        }

        .cal-day:hover {
            background-color: #E5E7EB;
        }

        .cal-day.today {
            border-color: var(--primary);
            background-color: #EFF6FF;
            font-weight: bold;
            color: var(--primary);
        }

        .day-events-sidebar h3 {
            margin-bottom: 16px;
            color: var(--text-muted);
        }

        .no-events {
            color: var(--text-muted);
            font-style: italic;
            text-align: center;
            margin-top: 20px;
        }

        /* Settings / Admin Form */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-main);
        }

        input[type="text"], 
        input[type="url"], 
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
        }

        .toast {
            background-color: var(--text-main);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body { flex-direction: column; height: auto; min-height: 100vh; }
            aside { width: 100%; flex-direction: row; align-items: center; justify-content: space-between; padding: 10px 20px; }
            .brand { margin-bottom: 0; font-size: 1.2rem; }
            nav { display: none; } 
            .calendar-layout { grid-template-columns: 1fr; }
            main { padding: 16px; }
        }
    </style>
</head>
<body>

    <!-- Sidebar Navigation -->
    <aside>
        <div class="brand">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--primary)">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            CACPT <span>Connect</span>
        </div>
        <nav>
            <button onclick="navigate('dashboard')" id="nav-dashboard" class="active" data-i18n="nav_dashboard">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                Dashboard
            </button>
            <button onclick="navigate('livestream')" id="nav-livestream" data-i18n="nav_livestream">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                Live Stream
            </button>
            <button onclick="navigate('zoom')" id="nav-zoom">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 7l-7 5 7 5V7z"></path><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                Zoom
            </button>
            <button onclick="navigate('calendar')" id="nav-calendar" data-i18n="nav_calendar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                Event Calendar
            </button>
            <button onclick="navigate('settings')" id="nav-settings" style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1);" data-i18n="nav_settings">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                Admin & Settings
            </button>
            
            <button class="lang-toggle" onclick="toggleLanguage()" id="btn-lang">
                EN / ES
            </button>
        </nav>
    </aside>

    <!-- Main Content -->
    <main>
        <header>
            <h1 id="page-title" data-i18n="title_dashboard">Welcome to CACPT Connect</h1>
            <p class="subtitle" data-i18n="subtitle">Your central hub for church life, spiritual growth, and community connection</p>
        </header>

        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <!-- Live Stream Card -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title" data-i18n="card_livestream">Service is Live!</span>
                    <div class="badge-live">LIVE</div>
                </div>
                <p style="margin-bottom: 16px; color: var(--text-muted);" data-i18n="join_realtime">Join us for worship in real-time.</p>
                <div class="video-container" id="dashboard-video-container">
                    <!-- Iframe injected by JS -->
                    <div style="text-align: center; padding: 20px;">
                        <p data-i18n="no_stream_config">No stream configured.</p>
                        <button onclick="navigate('settings')" style="color: var(--primary); background:none; border:none; text-decoration:underline; cursor:pointer; margin-top:8px;" data-i18n="go_to_settings">Go to Settings to set URL</button>
                    </div>
                </div>
            </div>

            <!-- Announcements Card -->
            <div class="card announcement-box">
                <div class="card-header">
                    <span class="card-title" data-i18n="nav_announcements">Announcements</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                </div>
                <div class="announcement-text" id="dashboard-announcement">
                    <!-- Content injected by JS -->
                </div>
            </div>
        </section>

        <!-- LIVE STREAM SECTION -->
        <section id="livestream" class="section">
            <div class="card">
                <div class="card-header">
                    <span class="card-title" data-i18n="card_livestream_full">Main Sanctuary Live Stream</span>
                    <div class="badge-live">LIVE</div>
                </div>
                <div class="video-container" id="livestream-video-container">
                    <!-- JS Injected -->
                </div>
                <div style="margin-top: 20px;">
                    <h3 data-i18n="chat_label">Chat</h3>
                    <p style="color: var(--text-muted); margin-top: 8px;" data-i18n="chat_disabled">Chat functionality is disabled in this demo.</p>
                </div>
            </div>
        </section>

        <!-- ZOOM SECTION -->
        <section id="zoom" class="section">
            <div class="card zoom-hero">
                <div class="zoom-icon-circle">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 7l-7 5 7 5V7z"></path>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                </div>
                <h2 data-i18n="zoom_join_title">Join Online Meeting</h2>
                <p style="color: var(--text-muted); max-width: 500px; margin: 0 auto 30px;" data-i18n="zoom_desc">
                    Connect with our community from anywhere. Click the button below to join the meeting via the Zoom app or web browser.
                </p>

                <div class="zoom-details-grid">
                    <div class="zoom-detail-item">
                        <span class="zoom-detail-label" data-i18n="zoom_id">Meeting ID</span>
                        <span class="zoom-detail-value" id="zoom-display-id">---</span>
                    </div>
                    <div class="zoom-detail-item">
                        <span class="zoom-detail-label" data-i18n="zoom_pass">Passcode</span>
                        <span class="zoom-detail-value" id="zoom-display-pass">---</span>
                    </div>
                </div>

                <a id="zoom-join-btn" href="#" target="_blank" class="btn-primary" style="font-size: 1.2rem; padding: 16px 32px;" data-i18n="zoom_btn">
                    Join Zoom Meeting
                </a>

                <p style="margin-top: 20px; font-size: 0.9rem; color: var(--text-muted);" data-i18n="zoom_trouble">
                    Having trouble? Contact the church office.
                </p>
            </div>
        </section>

        <!-- CALENDAR SECTION -->
        <section id="calendar" class="section">
            <div class="calendar-layout">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title" id="current-month-display">January 2026</span>
                        <div>
                            <button class="btn-primary" style="padding: 4px 8px; font-size: 0.9rem;" onclick="changeMonth(-1)">&lt;</button>
                            <button class="btn-primary" style="padding: 4px 8px; font-size: 0.9rem;" onclick="changeMonth(1)">&gt;</button>
                        </div>
                    </div>
                    <div class="calendar-grid">
                        <div class="cal-day-header" data-i18n="cal_sun">Sun</div>
                        <div class="cal-day-header" data-i18n="cal_mon">Mon</div>
                        <div class="cal-day-header" data-i18n="cal_tue">Tue</div>
                        <div class="cal-day-header" data-i18n="cal_wed">Wed</div>
                        <div class="cal-day-header" data-i18n="cal_thu">Thu</div>
                        <div class="cal-day-header" data-i18n="cal_fri">Fri</div>
                        <div class="cal-day-header" data-i18n="cal_sat">Sat</div>
                        <!-- Days injected by JS -->
                    </div>
                </div>
                
                <div class="card day-events-sidebar">
                    <h3 id="selected-date-label" data-i18n="cal_events_today">Events for Today</h3>
                    <div id="events-list">
                        <p class="no-events" data-i18n="cal_no_events">No events scheduled for this day.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SETTINGS / ADMIN SECTION -->
        <section id="settings" class="section">
            <div class="card">
                <div class="card-header">
                    <span class="card-title" data-i18n="admin_title">Admin Settings</span>
                </div>
                <p style="margin-bottom: 24px; color: var(--text-muted);" data-i18n="admin_desc">Update the live stream URL, announcements, and Zoom details.</p>

                <form id="settings-form" onsubmit="saveSettings(event)">
                    
                    <!-- Zoom Settings -->
                    <h3 style="margin: 20px 0 15px; padding-bottom:10px; border-bottom:1px solid #eee;" data-i18n="admin_zoom_title">Zoom Configuration</h3>
                    
                    <div class="form-group">
                        <label for="zoom-link" data-i18n="admin_zoom_link">Zoom Meeting Link</label>
                        <input type="url" id="zoom-link" placeholder="https://zoom.us/j/123456789">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="zoom-id" data-i18n="admin_zoom_id">Meeting ID</label>
                            <input type="text" id="zoom-id" placeholder="123 456 789">
                        </div>
                        <div class="form-group">
                            <label for="zoom-pass" data-i18n="admin_zoom_pass">Passcode</label>
                            <input type="text" id="zoom-pass" placeholder="1234">
                        </div>
                    </div>

                    <!-- Live Stream Settings -->
                    <h3 style="margin: 30px 0 15px; padding-bottom:10px; border-bottom:1px solid #eee;" data-i18n="admin_stream_title">Live Stream Configuration</h3>
                    
                    <div class="form-group">
                        <label for="stream-url" data-i18n="admin_stream_url">Live Stream URL (YouTube or Vimeo)</label>
                        <input type="url" id="stream-url" placeholder="https://www.youtube.com/watch?v=...">
                    </div>

                    <!-- Announcements -->
                    <h3 style="margin: 30px 0 15px; padding-bottom:10px; border-bottom:1px solid #eee;" data-i18n="admin_ann_title">Announcements</h3>

                    <div class="form-group">
                        <label for="announcement-text" data-i18n="admin_ann_text">Announcement Text</label>
                        <textarea id="announcement-text" placeholder="Type your church announcement here..."></textarea>
                    </div>

                    <button type="submit" class="btn-primary" data-i18n="admin_save">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        Save Changes
                    </button>
                </form>
            </div>
        </section>

    </main>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // --- TRANSLATIONS ---
        const translations = {
            en: {
                nav_dashboard: "Dashboard",
                nav_livestream: "Live Stream",
                nav_calendar: "Event Calendar",
                nav_settings: "Admin & Settings",
                nav_announcements: "Announcements",
                title_dashboard: "Welcome to CACPT Connect",
                subtitle: "Your central hub for church life, spiritual growth, and community connection",
                card_livestream: "Service is Live!",
                join_realtime: "Join us for worship in real-time.",
                no_stream_config: "No stream configured.",
                go_to_settings: "Go to Settings to set URL",
                card_livestream_full: "Main Sanctuary Live Stream",
                chat_label: "Chat",
                chat_disabled: "Chat functionality is disabled in this demo.",
                zoom_join_title: "Join Online Meeting",
                zoom_desc: "Connect with our community from anywhere. Click the button below to join the meeting via the Zoom app or web browser.",
                zoom_id: "Meeting ID",
                zoom_pass: "Passcode",
                zoom_btn: "Join Zoom Meeting",
                zoom_trouble: "Having trouble? Contact the church office.",
                zoom_waiting: "Waiting for Admin...",
                cal_sun: "Sun", cal_mon: "Mon", cal_tue: "Tue", cal_wed: "Wed", cal_thu: "Thu", cal_fri: "Fri", cal_sat: "Sat",
                cal_events_today: "Events for Today",
                cal_no_events: "No events scheduled for this day.",
                admin_title: "Admin Settings",
                admin_desc: "Update the live stream URL, announcements, and Zoom details.",
                admin_zoom_title: "Zoom Configuration",
                admin_zoom_link: "Zoom Meeting Link",
                admin_zoom_id: "Meeting ID",
                admin_zoom_pass: "Passcode",
                admin_stream_title: "Live Stream Configuration",
                admin_stream_url: "Live Stream URL (YouTube or Vimeo)",
                admin_ann_title: "Announcements",
                admin_ann_text: "Announcement Text",
                admin_save: "Save Changes",
                toast_success: "Settings saved successfully!",
                months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
            },
            es: {
                nav_dashboard: "Tablero",
                nav_livestream: "Transmisión",
                nav_calendar: "Calendario de Eventos",
                nav_settings: "Ajustes",
                nav_announcements: "Anuncios",
                title_dashboard: "Bienvenido a CACPT Connect",
                subtitle: "Tu centro central para la vida de la iglesia, el crecimiento espiritual y la conexión comunitaria",
                card_livestream: "¡El servicio está en vivo!",
                join_realtime: "Únanse a nosotros para la adoración en tiempo real.",
                no_stream_config: "No hay transmisión configurada.",
                go_to_settings: "Vaya a Ajustes para configurar la URL",
                card_livestream_full: "Transmisión del Santuario Principal",
                chat_label: "Chat",
                chat_disabled: "La funcionalidad de chat está deshabilitada en esta demostración.",
                zoom_join_title: "Unirse a la reunión en línea",
                zoom_desc: "Conéctese con nuestra comunidad desde cualquier lugar. Haga clic en el botón de abajo para unirse a la reunión a través de la aplicación Zoom o navegador web.",
                zoom_id: "ID de la reunión",
                zoom_pass: "Contraseña",
                zoom_btn: "Unirse a la reunión de Zoom",
                zoom_trouble: "¿Tiene problemas? Contacte la oficina de la iglesia.",
                zoom_waiting: "Esperando al administrador...",
                cal_sun: "Dom", cal_mon: "Lun", cal_tue: "Mar", cal_wed: "Mié", cal_thu: "Jue", cal_fri: "Vie", cal_sat: "Sáb",
                cal_events_today: "Eventos para Hoy",
                cal_no_events: "No hay eventos programados para este día.",
                admin_title: "Ajustes del Administrador",
                admin_desc: "Actualice la URL de transmisión, anuncios y detalles de Zoom.",
                admin_zoom_title: "Configuración de Zoom",
                admin_zoom_link: "Enlace de reunión de Zoom",
                admin_zoom_id: "ID de la reunión",
                admin_zoom_pass: "Contraseña",
                admin_stream_title: "Configuración de Transmisión",
                admin_stream_url: "URL de Transmisión (YouTube o Vimeo)",
                admin_ann_title: "Anuncios",
                admin_ann_text: "Texto del Anuncio",
                admin_save: "Guardar Cambios",
                toast_success: "¡Ajustes guardados con éxito!",
                months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]
            }
        };

        // --- DATA MANAGEMENT ---

        const STORAGE_KEY = 'cacpt_connect_v3';
        
        let appState = {
            streamUrl: '',
            announcement: '',
            zoomLink: '',
            zoomId: '',
            zoomPass: '',
            currentDate: new Date(),
            currentLang: 'en'
        };

        function loadState() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                const parsed = JSON.parse(stored);
                appState.streamUrl = parsed.streamUrl || '';
                appState.announcement = parsed.announcement || '';
                appState.zoomLink = parsed.zoomLink || '';
                appState.zoomId = parsed.zoomId || '';
                appState.zoomPass = parsed.zoomPass || '';
                appState.currentLang = parsed.currentLang || 'en';
            }
            // If no announcement is saved, set default based on language
            if (!appState.announcement) {
                 appState.announcement = translations[appState.currentLang].title_dashboard;
            }
            updateUI();
        }

        function saveState() {
            const dataToSave = {
                streamUrl: appState.streamUrl,
                announcement: appState.announcement,
                zoomLink: appState.zoomLink,
                zoomId: appState.zoomId,
                zoomPass: appState.zoomPass,
                currentLang: appState.currentLang
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            updateUI();
        }

        // --- LANGUAGE LOGIC ---

        function toggleLanguage() {
            appState.currentLang = appState.currentLang === 'en' ? 'es' : 'en';
            saveState(); // Updates UI and saves preference
        }

        function applyLanguage() {
            const langData = translations[appState.currentLang];
            
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (langData[key]) {
                    el.innerText = langData[key];
                }
            });

            // Update Input Placeholders (hardcoded keys for simplicity)
            const inputs = {
                'stream-url': { en: "https://www.youtube.com/watch?v=...", es: "https://www.youtube.com/watch?v=..." },
                'zoom-link': { en: "https://zoom.us/j/123456789", es: "https://zoom.us/j/123456789" },
                'announcement-text': { en: "Type your church announcement here...", es: "Escriba su anuncio de la iglesia aquí..." }
            };

            // Only set placeholder if value is empty to avoid overwriting user text
            for (const [id, ph] of Object.entries(inputs)) {
                const el = document.getElementById(id);
                if (el && el.value === "") {
                    el.placeholder = ph[appState.currentLang];
                }
            }

            // Re-render calendar for month names
            renderCalendar();
        }

        // --- URL PARSING ---
        function getEmbedUrl(url) {
            if (!url) return null;
            const ytRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const ytMatch = url.match(ytRegex);
            if (ytMatch) return `https://www.youtube.com/embed/${ytMatch[1]}?autoplay=1&mute=1`;
            
            const vimeoRegex = /(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/;
            const vimeoMatch = url.match(vimeoRegex);
            if (vimeoMatch) return `https://player.vimeo.com/video/${vimeoMatch[1]}?autoplay=1&muted=1`;

            if (url.includes('embed')) return url;
            return null;
        }

        // --- UI UPDATES ---
        function updateUI() {
            applyLanguage();

            const langData = translations[appState.currentLang];

            // Announcement Text
            const annElement = document.getElementById('dashboard-announcement');
            annElement.textContent = appState.announcement || langData.no_stream_config;

            // Settings Form Inputs
            document.getElementById('stream-url').value = appState.streamUrl;
            document.getElementById('announcement-text').value = appState.announcement;
            document.getElementById('zoom-link').value = appState.zoomLink;
            document.getElementById('zoom-id').value = appState.zoomId;
            document.getElementById('zoom-pass').value = appState.zoomPass;

            // Video Players
            const embedUrl = getEmbedUrl(appState.streamUrl);
            const dashboardVideoDiv = document.getElementById('dashboard-video-container');
            const livestreamVideoDiv = document.getElementById('livestream-video-container');

            const placeholderHtml = `<div style="text-align: center; padding: 40px; color: #9CA3AF;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>
                        <p style="margin-top:10px">Video Player Placeholder</p>
                   </div>`;

            const iframeHtml = embedUrl 
                ? `<iframe src="${embedUrl}" title="Video Player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>` 
                : placeholderHtml;

            dashboardVideoDiv.innerHTML = iframeHtml;
            livestreamVideoDiv.innerHTML = iframeHtml;

            // Zoom Page
            const zoomDisplayId = document.getElementById('zoom-display-id');
            const zoomDisplayPass = document.getElementById('zoom-display-pass');
            const zoomJoinBtn = document.getElementById('zoom-join-btn');

            zoomDisplayId.textContent = appState.zoomId || "Not Set";
            zoomDisplayPass.textContent = appState.zoomPass || "None";

            if (appState.zoomLink) {
                zoomJoinBtn.href = appState.zoomLink;
                zoomJoinBtn.style.opacity = "1";
                zoomJoinBtn.style.pointerEvents = "auto";
                zoomJoinBtn.innerText = langData.zoom_btn;
            } else {
                zoomJoinBtn.href = "#";
                zoomJoinBtn.style.opacity = "0.5";
                zoomJoinBtn.style.pointerEvents = "none";
                zoomJoinBtn.innerText = langData.zoom_waiting;
            }

            // Update Language Button Text
            const nextLang = appState.currentLang === 'en' ? 'ES' : 'EN';
            document.getElementById('btn-lang').innerText = `Switch to ${nextLang}`;
        }

        // --- NAVIGATION ---
        function navigate(pageId) {
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
            const navBtn = document.getElementById('nav-' + pageId);
            if(navBtn) navBtn.classList.add('active');

            const titles = {
                'dashboard': 'title_dashboard',
                'livestream': 'card_livestream_full',
                'zoom': 'zoom_join_title',
                'calendar': 'nav_calendar',
                'settings': 'admin_title'
            };
            const langData = translations[appState.currentLang];
            document.getElementById('page-title').innerText = langData[titles[pageId]];
        }

        // --- FORM HANDLING ---
        function saveSettings(e) {
            e.preventDefault();
            appState.streamUrl = document.getElementById('stream-url').value;
            appState.announcement = document.getElementById('announcement-text').value;
            appState.zoomLink = document.getElementById('zoom-link').value;
            appState.zoomId = document.getElementById('zoom-id').value;
            appState.zoomPass = document.getElementById('zoom-pass').value;
            saveState();
            
            showToast(langData.toast_success || "Saved!", 'success');
        }

        function showToast(message, type) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- CALENDAR LOGIC ---
        function renderCalendar() {
            const grid = document.querySelector('.calendar-grid');
            const monthLabel = document.getElementById('current-month-display');
            const date = appState.currentDate;
            const langData = translations[appState.currentLang];
            
            const year = date.getFullYear();
            const month = date.getMonth();
            
            monthLabel.innerText = `${langData.months[month]} ${year}`;

            const headers = grid.querySelectorAll('.cal-day-header');
            grid.innerHTML = '';
            headers.forEach(h => grid.appendChild(h));

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for(let i=0; i<firstDay; i++) {
                const empty = document.createElement('div');
                grid.appendChild(empty);
            }

            const today = new Date();
            for(let d=1; d<=daysInMonth; d++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'cal-day';
                dayEl.innerText = d;
                if (d === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayEl.classList.add('today');
                }
                dayEl.onclick = () => showDateEvents(d, langData.months[month]);
                grid.appendChild(dayEl);
            }
        }

        function changeMonth(offset) {
            const newDate = new Date(appState.currentDate);
            newDate.setMonth(newDate.getMonth() + offset);
            appState.currentDate = newDate;
            renderCalendar();
        }

        function showDateEvents(day, month) {
            const langData = translations[appState.currentLang];
            const label = document.getElementById('selected-date-label');
            const list = document.getElementById('events-list');
            label.innerText = `${langData.cal_events_today}: ${month} ${day}`;
            list.innerHTML = `<p class="no-events">${langData.cal_no_events}</p>`;
        }

        // Initialize
        loadState();

    </script>
</body>
</html>